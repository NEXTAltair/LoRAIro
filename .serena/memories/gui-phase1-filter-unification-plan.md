# Phase 1: FilterSearchPanel統一化計画書

## 🎯 **Phase概要**
**目的**: filter.py と filter_search_panel.py の重複実装を統一し、DatasetStateManager統合によるthumbnail.pyパターンを適用

**優先度**: 最高  
**推定工数**: 10.5-13.5時間  
**前提条件**: thumbnail.pyの責任分離パターンが確立済み  
**成果物**: 統一されたFilterSearchPanel + DatasetStateManager統合

## 📋 **詳細タスク分割** (10タスク)

### 🔍 **Task 1.1: 差分分析** (1-2時間)
**目的**: 2つの実装ファイルの詳細な違いを把握  
**状態**: 未開始  
**依存関係**: なし  

**実行内容**:
- `filter.py` のFilterSearchPanel機能分析
- `filter_search_panel.py` の実装内容分析  
- 機能差分マトリックス作成
- 統合方針決定のための比較表作成

**成果物**:
- [ ] 機能差分分析レポート
- [ ] 統合方針決定ドキュメント
- [ ] 技術的課題の洗い出し

### 🏗️ **Task 1.2: 統一アーキテクチャ設計** (1時間)
**目的**: thumbnail.pyパターンを適用した統一設計  
**状態**: 未開始  
**依存関係**: Task 1.1完了  

**実行内容**:
- DatasetStateManager統合パターン設計
- UI/ロジック/状態の責任分離設計
- インターフェース定義作成
- 継承関係とシグナル/スロット設計

**成果物**:
- [ ] アーキテクチャ設計書
- [ ] クラス構造図
- [ ] シグナル/スロット設計

### 🔧 **Task 1.3: CustomRangeSlider分離準備** (30分)
**目的**: 独立コンポーネントとして再利用可能にする  
**状態**: 未開始  
**依存関係**: なし (並行実行可能)  

**実行内容**:
- CustomRangeSlider依存関係確認
- 独立性検証と必要な修正特定
- 共通ウィジェットとしての配置計画

**成果物**:
- [ ] 依存関係分析レポート
- [ ] 独立化実装計画

### ⚙️ **Task 1.4: SearchConditionBuilder設計** (1時間)
**目的**: 検索条件構築ロジックの分離  
**状態**: 未開始  
**依存関係**: Task 1.2完了  

**実行内容**:
- 検索条件の型定義作成
- 条件構築アルゴリズム設計
- FilterSearchPanelとの連携インターフェース設計
- DatasetStateManagerとの統合設計

**成果物**:
- [ ] SearchConditionBuilder設計書
- [ ] 型定義・インターフェース仕様
- [ ] アルゴリズム設計書

### 🎨 **Task 1.5: 統一FilterSearchPanel実装** (2-3時間)
**目的**: UIレイヤーの統一実装  
**状態**: 未開始  
**依存関係**: Task 1.2, 1.4完了  

**実行内容**:
- 統一されたUI構造実装
- DatasetStateManager統合実装
- シグナル/スロット接続実装
- CustomRangeSlider統合実装
- レスポンシブレイアウト実装

**成果物**:
- [ ] 統一FilterSearchPanel実装
- [ ] DatasetStateManager統合コード
- [ ] UI/UXテスト済み実装

### 🔗 **Task 1.6: DatasetStateManager統合** (1時間)
**目的**: 状態管理の中央化  
**状態**: 未開始  
**依存関係**: Task 1.5完了  

**実行内容**:
- フィルター状態のDatasetStateManager統合
- 状態変更通知の実装
- フィルター条件の永続化実装
- thumbnail.pyパターンとの整合性確保

**成果物**:
- [ ] 状態管理統合実装
- [ ] 永続化機能
- [ ] パターン整合性確認

### 🏢 **Task 1.7: MainWorkspaceWindow統合更新** (30分)
**目的**: メインウィンドウでの統合  
**状態**: 未開始  
**依存関係**: Task 1.6完了  

**実行内容**:
- 新FilterSearchPanelのインスタンス化
- 既存接続の更新
- シグナル/スロット接続の更新
- 互換性確認

**成果物**:
- [ ] MainWorkspaceWindow統合実装
- [ ] 接続確認・動作検証

### 🧪 **Task 1.8: 単体テスト作成/更新** (1-2時間)
**目的**: 新実装の品質保証  
**状態**: 未開始  
**依存関係**: Task 1.5完了 (部分並行実行可能)  

**実行内容**:
- FilterSearchPanel単体テスト作成
- SearchConditionBuilder単体テスト作成
- DatasetStateManager連携テスト作成
- CustomRangeSliderテスト更新

**成果物**:
- [ ] 完全な単体テストスイート
- [ ] カバレッジ75%以上
- [ ] CI/CD統合確認

### 🔍 **Task 1.9: 統合テスト・回帰テスト** (1時間)
**目的**: システム全体の動作確認  
**状態**: 未開始  
**依存関係**: Task 1.7, 1.8完了  

**実行内容**:
- フィルタリング機能の統合テスト
- MainWorkspaceWindowとの連携テスト
- パフォーマンステスト実行
- 既存機能の回帰テスト実行

**成果物**:
- [ ] 統合テスト結果レポート
- [ ] パフォーマンス検証結果
- [ ] 回帰テスト合格確認

### 🧹 **Task 1.10: クリーンアップ** (30分)
**目的**: 重複ファイルの除去と整理  
**状態**: 未開始  
**依存関係**: Task 1.9完了  

**実行内容**:
- 古いfilter.py削除（必要な部分のみ移行後）
- インポート文の更新
- 不要なコメント・コード削除
- ドキュメント更新

**成果物**:
- [ ] クリーンな実装
- [ ] 更新されたドキュメント
- [ ] 移行完了確認

## ⏱️ **推定時間詳細**
- **高優先度タスク**: 7-9時間 (Task 1.1, 1.2, 1.4, 1.5, 1.6)
- **中優先度タスク**: 3-4時間 (Task 1.3, 1.7, 1.8, 1.9)  
- **低優先度タスク**: 30分 (Task 1.10)
- **合計**: 10.5-13.5時間

## 🎯 **成功基準**
- [ ] **重複実装の完全解消**: filter.py削除、filter_search_panel.pyへの統一
- [ ] **DatasetStateManager統合完了**: thumbnail.pyパターンの一貫適用
- [ ] **テストカバレッジ75%以上維持**: 品質保証基準満足
- [ ] **既存機能の100%互換性**: 回帰なし、全機能維持
- [ ] **パフォーマンス劣化なし**: レスポンス時間維持

## 🔗 **Phase間依存関係**
- **Phase 2への影響**: 統一FilterSearchPanelパターンの他ウィジェットへの適用
- **Phase 3への影響**: DatasetStateManager統合パターンの標準化
- **全体への影響**: UI責任分離パターンの確立

## 📋 **並行実行可能性**
- **Task 1.3**: 他タスクと独立実行可能
- **Task 1.8（部分）**: Task 1.5完了後の部分並行実行
- **設計フェーズ並行**: Task 1.1-1.4の一部重複実行可能

## 🔄 **次フェーズ準備**
- Phase 2でのAnnotationControlWidget分離への知見提供
- Phase 3でのプレビュー系標準化への統一パターン適用
- Master調整での技術的課題・解決策の共有

---
**作成日**: 2025/08/02  
**フェーズ**: Phase 1 - FilterSearchPanel統一化  
**ステータス**: 計画完了・実行準備完了  
**実行開始条件**: ユーザー承認後即実行可能