# ロギングガイドライン

**最終更新: 2026-02-02**

## 核心ルール

**INFOレベルでは1件ごとのログを出さない。**
判断基準: 「1万件処理しても読める量か」

## ログレベル定義

| レベル | 用途 | 例 |
|--------|------|-----|
| DEBUG | 個別アイテムの処理詳細 | DB操作1件、ファイル保存1件、重複検出1件 |
| INFO | 1回きりの操作・バッチサマリー | 初期化完了、バッチ開始/完了、ユーザー操作開始 |
| WARNING | 予期しないが継続可能 | リソース未検出、重複、APIキー未設定 |
| ERROR | 操作の失敗（exc_info=True必須） | DB例外、ファイルI/O失敗、API失敗 |

## 禁止パターン

1. **多層重複ログ**: 同じイベントをRepository層とManager層の両方でINFO出力しない
2. **毎回生成オブジェクトの初期化ログ**: 画像ごとに生成されるクラスの__init__をINFOにしない
3. **ループ内INFO**: forループの中でlogger.infoを呼ばない

## INFO出力の判断フロー

1. 1回きりの操作か? → YES → INFO可
2. N件のうちの1件か? → YES → DEBUG
3. ユーザー操作の直接応答か? → YES → INFO可
4. 内部コンポーネントの動作詳細か? → YES → DEBUG

## 詳細ルール

完全なルールは `.claude/rules/logging.md` を参照。

## 過去の教訓 (2026-02-02)

登録処理で5層（db_repository, db_manager, file_system, image_processor, registration_worker）が
それぞれINFOログを出力し、1画像あたり5行以上のINFOが発生した。
修正: 全per-itemログをDEBUGに変更、バッチサマリーのみINFO維持。