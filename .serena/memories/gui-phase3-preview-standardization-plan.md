# Phase 3: プレビュー系標準化計画書

## 🎯 **Phase概要**
**目的**: プレビュー・詳細系ウィジェットの継承パターン統一とDB操作分離による標準化

**優先度**: 中  
**推定工数**: 4-6時間  
**前提条件**: Phase 1-2の責任分離パターンが確立済み  
**成果物**: 統一継承パターン + DB操作分離 + DatasetStateManager統合

## 📋 **対象ウィジェット分析**

### **現状の問題**
- **ImagePreviewWidget**: 基本的なUI継承のみ、機能が限定的
- **SelectedImageDetailsWidget**: DB管理機能が混在、責任が不明確
- **継承パターン不統一**: QWidget + Ui_* パターンと独自実装が混在

### **標準化戦略**
- **統一継承パターン**: QWidget + Ui_* パターンに完全統一
- **DB操作分離**: データアクセスをサービス層に移動
- **状態管理統合**: DatasetStateManager連携による統一状態管理

## 📋 **詳細タスク分割** (8タスク)

### 🔍 **Task 3.1: 現状プレビュー系ウィジェット分析** (30分)
**目的**: 現在の実装状況と標準化対象の把握  
**状態**: 未開始  
**依存関係**: なし  

**実行内容**:
- ImagePreviewWidget の機能範囲分析
- SelectedImageDetailsWidget の責任範囲分析
- 継承パターンの現状調査
- 標準化必要箇所の特定

**成果物**:
- [ ] 現状分析レポート
- [ ] 標準化対象リスト
- [ ] 継承パターン整理表

### 🏗️ **Task 3.2: 統一継承パターン設計** (1時間)
**目的**: QWidget + Ui_* 統一パターンの詳細設計  
**状態**: 未開始  
**依存関係**: Task 3.1完了  

**実行内容**:
- 統一継承パターンの標準仕様設計
- UI/ロジック分離の標準設計
- DatasetStateManager統合パターン設計
- 既存機能を壊さない移行戦略設計

**成果物**:
- [ ] 統一継承パターン仕様書
- [ ] 標準アーキテクチャ設計書
- [ ] 移行戦略計画書

### 🖼️ **Task 3.3: ImagePreviewWidget標準化実装** (1時間)
**目的**: 統一パターンへの変換と機能拡張  
**状態**: 未開始  
**依存関係**: Task 3.2完了  

**実行内容**:
- QWidget + Ui_* パターンへの変換
- DatasetStateManager統合実装
- プレビュー機能の拡張・最適化
- 状態管理とUI更新の分離実装

**成果物**:
- [ ] 標準化されたImagePreviewWidget
- [ ] DatasetStateManager統合実装
- [ ] 機能拡張・最適化実装

### 🗃️ **Task 3.4: DB操作分離サービス設計** (30分)
**目的**: SelectedImageDetailsWidget のDB操作をサービス層に分離  
**状態**: 未開始  
**依存関係**: Task 3.2完了  

**実行内容**:
- DB操作の抽出・分析
- ImageDetailsService サービス設計
- データアクセスパターンの標準化設計
- 既存DB管理機能との統合設計

**成果物**:
- [ ] ImageDetailsService設計書
- [ ] DB操作分離設計書
- [ ] データアクセス標準仕様

### 📊 **Task 3.5: SelectedImageDetailsWidget分離実装** (1-2時間)
**目的**: DB操作除去とUI専用ウィジェットへの変換  
**状態**: 未開始  
**依存関係**: Task 3.4完了  

**実行内容**:
- DB操作ロジックの除去
- ImageDetailsService連携実装
- 統一継承パターンへの変換
- DatasetStateManager統合実装

**成果物**:
- [ ] DB操作分離済みSelectedImageDetailsWidget
- [ ] ImageDetailsService連携実装
- [ ] 統一パターン適用実装

### 🔧 **Task 3.6: ImageDetailsService実装** (1時間)
**目的**: 画像詳細情報管理の独立サービス実装  
**状態**: 未開始  
**依存関係**: Task 3.4完了  

**実行内容**:
- 画像詳細データ取得・更新機能実装
- Rating/Score更新機能実装
- DB管理機能との統合実装
- エラーハンドリング・例外処理実装

**成果物**:
- [ ] 完全なImageDetailsService実装
- [ ] DB統合機能実装
- [ ] エラーハンドリング実装

### 🏢 **Task 3.7: MainWorkspaceWindow統合更新** (30分)
**目的**: メインウィンドウでの新構成統合  
**状態**: 未開始  
**依存関係**: Task 3.3, 3.5, 3.6完了  

**実行内容**:
- 標準化ウィジェットのインスタンス化
- ImageDetailsServiceの統合
- 既存接続の更新・標準化
- 統合動作確認

**成果物**:
- [ ] MainWorkspaceWindow統合実装
- [ ] サービス統合確認
- [ ] 標準パターン適用確認

### 🧪 **Task 3.8: テスト・検証・クリーンアップ** (1時間)
**目的**: 標準化実装の品質保証と完了処理  
**状態**: 未開始  
**依存関係**: Task 3.7完了  

**実行内容**:
- 標準化ウィジェット単体テスト作成
- ImageDetailsService単体テスト作成
- 統合テスト・回帰テスト実行
- 不要コード除去・ドキュメント更新

**成果物**:
- [ ] 完全なテストスイート
- [ ] 統合・回帰テスト結果
- [ ] クリーンアップ完了

## ⏱️ **推定時間詳細**
- **高優先度タスク**: 2-3時間 (Task 3.2, 3.5, 3.6)
- **中優先度タスク**: 2-3時間 (Task 3.3, 3.7, 3.8)  
- **低優先度タスク**: 1時間 (Task 3.1, 3.4)
- **合計**: 5-7時間

## 🎯 **成功基準**
- [ ] **継承パターン統一**: 全ウィジェットがQWidget + Ui_* パターン
- [ ] **DB操作分離完了**: UI層からのDB操作完全除去
- [ ] **DatasetStateManager統合**: 統一状態管理パターン適用
- [ ] **テストカバレッジ75%以上**: 品質保証基準満足
- [ ] **機能互換性100%**: 既存プレビュー・詳細機能の完全維持

## 🔗 **Phase間依存関係**
- **Phase 1-2からの継承**: 責任分離・統一アーキテクチャパターンの適用
- **全体への影響**: GUI層標準化パターンの完成
- **長期的効果**: 新規ウィジェット開発の標準テンプレート確立

## 📋 **並行実行可能性**
- **Task 3.1**: 他タスクと独立実行可能（調査タスク）
- **Task 3.3と3.4**: Task 3.2完了後、部分並行実行可能
- **Task 3.5と3.6**: 互いに依存しているが、設計部分は並行可能

## 🔄 **技術的シンプルさ**
Phase 3は他フェーズと比較して：
- **対象ウィジェット数が少ない**: 2つのみ
- **変更範囲が限定的**: 継承パターン変更とDB操作移動のみ
- **既存機能への影響小**: プレビュー・詳細機能は独立性が高い
- **テスト容易性**: 機能範囲が明確で検証しやすい

## 🔄 **Phase 3完了後の効果**
- **GUI層完全統一**: 全ウィジェットが統一アーキテクチャに準拠
- **開発テンプレート確立**: 新規ウィジェット開発の標準パターン確立
- **保守性向上**: 一貫した構造による保守・拡張の容易さ
- **品質標準化**: 統一されたテスト・検証パターン

## 🔄 **Master統合への準備**
- 全Phase完了によるアーキテクチャ統一達成
- 統合テスト・品質検証の実施準備
- 長期的な保守・拡張戦略の確立

---
**作成日**: 2025/08/02  
**フェーズ**: Phase 3 - プレビュー系標準化  
**ステータス**: 計画完了・Phase 1-2完了後実行可能  
**特徴**: 最もシンプルで影響範囲が限定的なフェーズ