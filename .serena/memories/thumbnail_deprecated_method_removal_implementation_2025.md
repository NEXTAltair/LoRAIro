# ã‚µãƒ ãƒã‚¤ãƒ«é¸æŠæ™‚ã®ç”»åƒæƒ…å ±è¡¨ç¤ºå•é¡Œ ä¿®æ­£å®Ÿè£…å®Œäº†

## å•é¡Œè§£æ±º
**ç—‡çŠ¶**: ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤ºå¾Œã€ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚ç”»åƒæƒ…å ±ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰ãŒè¡¨ç¤ºã•ã‚Œãªã„
**æ ¹æœ¬åŸå› **: éæ¨å¥¨ã® `apply_filtered_metadata()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒè¤‡æ•°ç®‡æ‰€ã‹ã‚‰ä¸¦è¡Œå‘¼ã³å‡ºã—ã•ã‚Œã€DatasetStateManagerã®æ­£å¸¸ãªçŠ¶æ…‹æ›´æ–°ã‚’å¦¨å®³
**è­¦å‘Šãƒ­ã‚°**: `apply_filtered_metadata() ã¯éæ¨å¥¨ã§ã™ã€‚DatasetStateManager.update_from_search_results() ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚`

## ä¿®æ­£å†…å®¹

### Phase 1: éæ¨å¥¨ãƒ¡ã‚½ãƒƒãƒ‰å®Œå…¨é™¤å»
1. **AnnotationCoordinatorä¿®æ­£** (`src/lorairo/gui/widgets/annotation_coordinator.py:332`)
   - `self.thumbnail_selector_widget.apply_filtered_metadata(filtered_images)` å‰Šé™¤
   - å‡¦ç†ã‚¹ã‚­ãƒƒãƒ—ã¨ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 

2. **ThumbnailSelectorWidgetä¿®æ­£** (`src/lorairo/gui/widgets/thumbnail.py:473-474`)
   - `_on_images_filtered()` ã‹ã‚‰ `apply_filtered_metadata()` å‘¼ã³å‡ºã—å‰Šé™¤
   - å‡¦ç†ã‚¹ã‚­ãƒƒãƒ—ã¨ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 

3. **éæ¨å¥¨ãƒ¡ã‚½ãƒƒãƒ‰æœ¬ä½“å‰Šé™¤** (`src/lorairo/gui/widgets/thumbnail.py:453-463`)
   - `apply_filtered_metadata()` ãƒ¡ã‚½ãƒƒãƒ‰å®Œå…¨å‰Šé™¤
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚ã€Œèªæ„Ÿå‡¦ç†ã¯å…¨éƒ¨æ¶ˆã—ã¦ã€ã«å®Œå…¨å¯¾å¿œ

### Phase 2: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨ºæ–­å¼·åŒ–
1. **DatasetStateManagerè¨ºæ–­å¼·åŒ–**
   - `get_image_by_id()`: æ¤œç´¢æˆåŠŸãƒ»å¤±æ•—æ™‚ã®è©³ç´°ãƒ­ã‚°è¿½åŠ 
   - `set_current_image()`: ã‚·ã‚°ãƒŠãƒ«ç™ºè¡ŒæˆåŠŸæ™‚ã®INFOãƒ­ã‚°è¿½åŠ 

2. **ImagePreviewWidgetè¨ºæ–­å¼·åŒ–**
   - `_on_image_data_received()`: ã‚·ã‚°ãƒŠãƒ«å—ä¿¡ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æˆåŠŸæ™‚ã®è©³ç´°ãƒ­ã‚°è¿½åŠ 
   - Enhanced Event-Driven Pattern ã®å‹•ä½œçŠ¶æ³ã‚’å¯è¦–åŒ–

### Phase 3: æ¤œè¨¼å®Œäº†
- âœ… æ§‹æ–‡ãƒã‚§ãƒƒã‚¯æ­£å¸¸å®Œäº†
- âœ… éæ¨å¥¨ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—å®Œå…¨å‰Šé™¤ç¢ºèª
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è¨ºæ–­ãƒ­ã‚°è¿½åŠ å®Œäº†

## ä¿®æ­£å¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```
1. æ¤œç´¢å®Ÿè¡Œ â†’ SearchWorker â†’ SearchResult
2. ThumbnailWorker â†’ ThumbnailLoadResult (image_metadataå«ã‚€) âœ…
3. ThumbnailSelectorWidget.load_thumbnails_from_result()
4. DatasetStateManager.update_from_search_results() âœ… (ç«¶åˆè§£æ¶ˆ)
5. ç”»åƒã‚¯ãƒªãƒƒã‚¯ â†’ handle_item_selection() â†’ set_current_image()
6. current_image_data_changed.emit() âœ… (ãƒ‡ãƒ¼ã‚¿å­˜åœ¨ç¢ºèªãƒ»ãƒ­ã‚°å‡ºåŠ›)
7. ImagePreviewWidget._on_image_data_received() âœ… (ã‚·ã‚°ãƒŠãƒ«å—ä¿¡ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º)
```

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ
- âœ… **éæ¨å¥¨è­¦å‘Šã®å®Œå…¨æ¶ˆå»**
- âœ… **ãƒ‡ãƒ¼ã‚¿ç«¶åˆçŠ¶æ…‹ã®è§£æ¶ˆ**  
- âœ… **ç”»åƒã‚¯ãƒªãƒƒã‚¯â†’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã®æ­£å¸¸åŒ–**
- âœ… **Enhanced Event-Driven Patternã®å®Œå…¨å‹•ä½œ**
- âœ… **"ç”»åƒãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—"ã‚¨ãƒ©ãƒ¼ã®è§£æ¶ˆ**

## è¨ºæ–­ãƒ­ã‚°è¿½åŠ 
ä¿®æ­£å¾Œã¯ä»¥ä¸‹ã®ãƒ­ã‚°ã§å‹•ä½œçŠ¶æ³ã‚’ç¢ºèªå¯èƒ½:
- `âœ… ç”»åƒé¸æŠæˆåŠŸ: ID XXX - current_image_data_changed ã‚·ã‚°ãƒŠãƒ«ç™ºè¡Œ`
- `ğŸ“¨ ImagePreviewWidget: current_image_data_changed ã‚·ã‚°ãƒŠãƒ«å—ä¿¡`
- `âœ… ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºæˆåŠŸ: ID=XXX - Enhanced Event-Driven Pattern å®Œå…¨å‹•ä½œ`

## æŠ€è¡“çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- **ãƒ‡ãƒ¼ã‚¿ç«¶åˆã®è§£æ¶ˆ**: ä¸¦è¡Œã™ã‚‹éæ¨å¥¨APIå‘¼ã³å‡ºã—ã®å®Œå…¨é™¤å»
- **è¨ºæ–­å¯èƒ½æ€§ã®å‘ä¸Š**: è©³ç´°ãªãƒ•ãƒ­ãƒ¼ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ­ã‚°ã®è¿½åŠ 
- **æœ€å°é™ä¿®æ­£**: å½±éŸ¿ç¯„å›²ã‚’é™å®šã—ãŸå®‰å…¨ãªä¿®æ­£
- **å¾Œæ–¹äº’æ›æ€§**: ã‚·ã‚°ãƒŠãƒ«/ã‚¹ãƒ­ãƒƒãƒˆæ§‹é€ ã®ç¶­æŒ

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šã€ThumbnailLoadResultä¿®æ­£ã¨åˆã‚ã›ã¦ã€ã‚µãƒ ãƒã‚¤ãƒ«é¸æŠæ™‚ã®ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºãŒå®Œå…¨ã«æ­£å¸¸åŒ–ã•ã‚Œã¾ã—ãŸã€‚