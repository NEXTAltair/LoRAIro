# 調査・分析フェーズ

AI画像アノテーションアプリケーション LoRAIro の問題調査と根本原因分析を行います。

## 使用方法
```bash
/investigate 調査対象の説明
```

## 重要原則
- 関連するコードは全て読むこと
- 全ての処理においてultrathinkでしっかりと考えて作業を行うこと

## 説明
調査対象: $ARGUMENTS

LoRAIroプロジェクトにおける上記問題や新機能要件について、体系的な調査・分析を実行します。既存のアーキテクチャ、設定、ローカルパッケージ統合を考慮した包括的な調査を行います。

## タスクに含まれるべきTODO
1. ultrathinkを使用した思考プロセスの明確化
2. 調査対象・スコープを明確化
3. 現在のブランチ状況を確認し、`feature/investigate-<topic>` ブランチを作成
4. 関連ファイル・ログ・ドキュメントを収集し、体系的に分析
5. Git履歴から調査対象モジュールの変更履歴を取得・分析
6. 技術的制約・可能性を調査
7. 既存システムとの整合性を確認
8. 問題の根本原因・解決方針を特定
9. 調査結果を文書化し、`tasks/investigations/investigate_{YYYYMMDD_HHMMSS}.md`に保存
10. 次フェーズ（Plan）への推奨事項を提示
11. 調査完了をコンソール出力で通知（echo "🔍 調査完了"）
12. 作成したブランチ名、調査結果ファイル名をコンソール出力

## 実行内容

### 1. プロジェクト状況確認
- 現在のタスク状況を `tasks/active_context.md` から確認
- 既存の要件を `docs/product_requirement_docs.md` から確認
- アーキテクチャを `docs/architecture.md` から確認

### 2. Git履歴分析
- 調査対象モジュールの変更履歴を `git log --oneline --follow` で取得
- 関連ファイルの最近のコミット履歴を分析
- 過去の修正パターンや設計決定の経緯を確認
- ブランチ間の差分やマージ履歴も考慮

### 3. コードベース分析
- 関連コンポーネントの特定と分析
- `src/lorairo/` 内の既存実装パターン確認
- ローカルパッケージ統合状況確認
  - `local_packages/image-annotator-lib`
  - `local_packages/genai-tag-db-tools`
- **関連するコードは全て読み込み、完全に理解する**

### 4. 設定・環境確認
- `config/lorairo.toml` の現在の設定確認
- データベーススキーマ (`src/lorairo/database/schema.py`) 確認
- 関連サービスとの依存関係分析

### 5. 問題特定
- 根本原因の特定
- 影響範囲の分析
- 既存パターンとの適合性確認
- Git履歴から得られた変更パターンの考慮

## 必読ファイル
- `CLAUDE.md` - プロジェクト全体の指針
- `.cursor/rules/rules.mdc` - 開発ルール
- `tasks/active_context.md` - 現在のコンテキスト
- `docs/architecture.md` - システム設計
- `src/lorairo/database/schema.py` - データ構造
- `config/lorairo.toml` - 設定ファイル

## 出力形式
1. **ultrathink思考プロセス**: 調査アプローチと思考の流れ
2. **現状分析**: 発見した事実と既存実装
3. **Git履歴分析**: 変更履歴から得られた設計パターンと進化
4. **問題特定**: 根本原因と影響範囲
5. **技術的考慮事項**: アーキテクチャ・パフォーマンス・セキュリティ
6. **次ステップ**: プランフェーズへの引き継ぎ事項

## 次のコマンド
調査完了後は `@plan` コマンドで実装戦略を策定します。